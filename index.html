<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		 <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
		 <link rel="stylesheet" href="lib/leaflet.draw/leaflet.draw.css"/>
		 <link rel="stylesheet" href="lib/leaflet.measurecontrol/leaflet.measurecontrol.css"/>
		 <link rel="stylesheet" href="css/main.css" />
	</head>
	<body>
		<div id="wrapper">
		<div id="header">
			<img src="images/cat.png"/>
		</div>
		<div id="container">
		 <div id="map"></div>
		</div>
		</div>
		 <script src="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
		 <script src="lib/leaflet.draw/leaflet.draw.js"></script>
		 <script src="lib/leaflet.measurecontrol/leaflet.measurecontrol.js"></script>
		 <script src="lib/leaflet-hash.js"></script>
		 <script>

var params = {};
window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
	params[key] = value;
});

var map = L.map('map').setView([53.90313, 27.56813], 7);

var latlon = L.tileLayer('http://tile.latlon.org/tiles/{z}/{x}/{y}.png', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
		'Tiles: <a href="https://github.com/jekhor/belroad">Belroad</a> style'
		});

var velo100 = L.tileLayer('http://tile.latlon.org/stranger/{z}/{x}/{y}.png', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
		'Tiles: <a href="http://чепецк.net/">чепецк.net</a> style'
		});

var genshtab = L.tileLayer.wms("http://ms.latlon.org/ms", {
	layers: 'GS-100k-N-34,GS-100k-N-35,GS-100k-N-36',
	format: 'image/png'
});

var baseLayers = {
	"LatLon": latlon,
	"чепецк.net": velo100,
	"Генштаб, 1км": genshtab
};

L.control.layers(baseLayers).addTo(map);

var hashLayers = {
	'L': latlon,
	'C': velo100,
	'G': genshtab
};

var control = L.Control.measureControl().addTo(map);

var hash = L.hash(map);
hash.formatHash = function(map, setLayer) {
	var center = map.getCenter(),
	zoom = map.getZoom(),
	precision = Math.max(0, Math.ceil(Math.log(zoom) / Math.LN2));

	var layers = "";
	for (l in hashLayers) {
		if (setLayer != undefined) {
			if (hashLayers[l] == setLayer)
				layers += l;
		} else {
			if (map.hasLayer(hashLayers[l]))
				layers += l;
		}
	}

	return "#" + [zoom,
	center.lat.toFixed(precision),
	center.lng.toFixed(precision)
	].join("/") + "?layers=" + layers;
};

if (params.layers) {
	var added = false;
	for (var i = 0; i < params.layers.length; i++) {
		if (hashLayers[params.layers[i]] != undefined) {
			hashLayers[params.layers[i]].addTo(map);
			added = true;
		}
	}
	if (!added)
		latlon.addTo(map);
} else {
	latlon.addTo(map);
}
map.on('baselayerchange', function(e) {
	location.replace(hash.formatHash(map, e.layer));;
});
		 </script>

<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//stat.komzpa.net/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 1]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//stat.komzpa.net/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

	</body>
</html>
